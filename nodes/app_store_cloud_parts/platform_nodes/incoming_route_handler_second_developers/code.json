{
  "type": "code:0.0.1:local:32498h32f2",
  "name": "code",
  "data": {
    "key": "8a1aec75-e403-4e69-84ad-da2fa3652758",
    "code": "(()=>{\n  \n  return new Promise(async (resolve, reject)=>{\n    try {\n      \n      // simple multi-page: INPUT.data.req.path\n      \n      // let htmlHeader = await renderPartial();\n      \n      let htmlMenu = '';\n      let htmlMain1 = '';\n      let htmlMain2 = '';\n      \nlet menuMd = `\n- [Getting Started](#getting-started)  \n- [Terminology](#terminology-and-architecture)  \n- [Identity and Routing](#identity-and-routing)  \n- [Shared Data](#shared-data)  \n  - [Examples](#examples-of-common-shared-data-typesschemas)  \n`\n\nlet md1 = `\n### Developer Documentation \n\nSecond is a self-hosted platform for a person or business to manage all their data and interfaces. Second eliminates many of the common obstacles for app development (infrastructure, APIs, authentication, data storage, deployment, distribution), resulting in broader distribution and a lower barrier for entry to new programmers (100x easier + 100x more programmers = faster iteration & more \"shoulders of giants\" to stand on). \n\n---- \n`\nlet md2 = `\n### Getting Started  \n\nIt is recommended that you read the [technical roadmap](/about#technical-roadmap) to understand where Second currently is, and the [Terminology and Architecture](#terminology-and-architecture) before getting started. \n\n1. Launch a Cloud Second  \n2. Launch the Browser App Store and connect to your Second  \n3. Install the Social app from the default App Store  \n\n\n\n### Terminology and Architecture  \n\nThese are the important primitives in Second, and where Second differs from existing approaches. \n\n\n__Platform__  \n\nThe platform defines where the Second is running; in the cloud, in a browser, mobile app, IoT device, etc. Each platform provides a common environment for running/hosting the Second, with similar, limited capabilities. \n\nThe platform requires a connection to a MongoDB-like database (the \\`universe\\`) and a JavaScript VM. \n\n\n__Universe__  \n\nThe universe is all of the data and logic stored inside your Second's database. When code is run inside your Second's JavaScript VM, it has capabilities available through the \\`universe\\` variable. \n\nThe schema of the universe/database defines the \\`filesystem\\`. \n\n__Filesystem__  \n\nThe filesystem is the way that everything is organized inside the universe/database. Every entry in the filesystem is called a \\`node\\`, and acts as BOTH a file and a directory. \n\n\\`node\\` schema: \n\n    {\n      _id: String,\n      nodeId: String,\n      name: String, \n      type: String, \n      data: Anything,\n      createdAt: Number (Date.now()),\n      updatedAt: Number (Date.now()),\n    }\n\n\\`_id\\`: unique internal database id   \n\\`nodeId\\`: points at another node in the internal database   \n\\`name\\`: basically the filename, usually random for shared data, useful for replacing nodes in apps   \n\\`type\\`: defines the schema of the data for the node. Format is \\`\"simple_name\":\"IPFS_hash\"\\`. (more info below)    \n\\`data\\`: data that conforms to the schema defined in the type   \n\nMore info:  \nNodes are not allowed to be recursive (always have to have one \\`nodeId\\` in the chain be null).  \nDeleting the parent node will delete all child nodes (no orphans allowed).  \nUnique index for \\`name\\` and \\`nodeId\\` effectively means no duplicate names on same-level.  \n\n\n__Types__  \n\nTypes defines the schema of the data for a node. A \\`type\\` is written in the format: \n\n\\`\"simple_name\":\"IPFS_hash\"\\`  such as \\`folder:Qmsfljdsfjk\\`\n\nThe IPFS hash will resolve to a node of type \\`language\\` that contains data in [jsSchema](https://github.com/molnarg/js-schema) format.   \n\n\\`\\`\\`json\n{\n  \"data\": {\n    \"name\": \"folder\",\n    \"description\": \"\",\n    \"schema\": {\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\"\n        },\n      },\n      \"type\": \"object\"\n    },\n    \"version\": \"1\"\n  },\n  \"type\": \"language\"\n}\n\\`\\`\\`\n\n\n\n\n\n\n\n__Identity__  \n\nAlso referred to as _username, routing layer, configuration,_ or _trust_.   \n\nSee \\`Identity and Routing\\` section below. \n\n\n__Second__ \n\nA Second is a combination of the \\`filesystem\\` and \\`platform\\`; when a request comes in, a code \\`node\\` is loaded from the filesystem and executed in the JavaScript VM on the platform. \n\n\n__Shared Data__  \n\nSharing data is 90% of the fun! See [Shared Data](#shared-data) below. \n\n\n\n\n\n### Identity and Routing  \n\nIdentities (previous called usernames/namespaces/domains) are stored on the Stellar network. A username/namespace is the SHA256 hash (32 bytes) used as the seed for an ED25519 key. \n\n\\`\\`\\`javascript\nlet StellarSdk = require('stellar-sdk');\nlet stellarServer = new StellarSdk.Server('https://horizon.stellar.org');\n\nfunction identity(tmpUser){\n  let username = tmpUser.normalize('NFKC').toLowerCase();\n  let seed = crypto.createHash('sha256').update(username).digest();\n  let pair = StellarSdk.Keypair.fromRawEd25519Seed(seed);\n  stellarServer.loadAccount(pair.publicKey())\n    .then(function(account){\n      // identity exists\n      console.log(account);\n    })\n    .catch(function(){\n      // identity does not exist on chain \n    })\n}\n\\`\\`\\`\n\nFor example, the username \\`Tellar\\` results in \\`pair.secret() => \"SBEFT2DDCK2FQ5CGJEBH2KJWLUOLN6FUMYDVQ7EGK2UGPHF33FD5RHE7\"\\`. \n\n> notice that \\`TeLLar\\` and \\`tellar\\` are the same, to limit ambiguity when transmitting usernames among individuals, usernames are normalized and common symbols are removed (see the code). \n\nViewing the public address of \\`tellar\\` ([view](https://horizon.stellar.org/accounts/GCJ2UTBPMZJJN6YX4DIFL33Y2LJJEWZEVUEN4HHI5WNSKYEXANVXFJL3)) gives us some useful information: \n\n\n\\`\\`\\`json\n{\n  \"thresholds\": {\n    \"low_threshold\": 2,\n    \"med_threshold\": 2,\n    \"high_threshold\": 2\n  },\n  \"signers\": [\n    {\n      \"public_key\": \"GBJ3R3AJL7T6JL34HSWPQJMBG73BNWXSAYVGVXULDXJG3WAJWB6PSALQ\",\n      \"weight\": 1,\n      \"key\": \"GBJ3R3AJL7T6JL34HSWPQJMBG73BNWXSAYVGVXULDXJG3WAJWB6PSALQ\",\n      \"type\": \"ed25519_public_key\"\n    },\n    {\n      \"public_key\": \"GCJ2UTBPMZJJN6YX4DIFL33Y2LJJEWZEVUEN4HHI5WNSKYEXANVXFJL3\",\n      \"weight\": 1,\n      \"key\": \"GCJ2UTBPMZJJN6YX4DIFL33Y2LJJEWZEVUEN4HHI5WNSKYEXANVXFJL3\",\n      \"type\": \"ed25519_public_key\"\n    }\n  ],\n  data: {\n    \"|second\": \"base64-ipfs-hash-1\",\n    \"nick|second\" : \"base64-ipfs-hash-2\"\n  }\n}\n\\`\\`\\`\n\n> The above should be read as: \"the person with Second at identity \\`tellar\\` is available at \\`base64-ipfs-hash-1\\`, and sub-user \\`nick@tellar\\` is available at \\`base64-ipfs-hash-2\\`.\"\n\n\nThe thresholds and signers are set so that two keys are needed in order to make any changes; both the username/seed, and a private seed that you control. \n\nThe \\`data\\` contains fields similar to DNS entries. In each data field, the \\`key\\` identifies the type of record (or the name+type), and the value is an IPFS hash of a Node with connection information. \n\n##### root identity \n\nYour root identity \"owns\" anything that starts with a pipe (\\`|\\`) character. \n\n\n##### namespaced identities \n\nYou can have many data records on an identity. \n\nWhen I want to lookup the sub-user \\`nick\\` on the main identity \\`acmecorp\\` (aka \\`nick@acmecorp\\`) I would look up the key \\`data['nick|second']\\`\n\n\n##### Types used in Identity Data (after \\`|\\` character)  \n\n__second__ - points to an External Identity Node for connecting to a Second  \n\\`\\`\\`json\n{\n  \"type\": \"external_identity:Qmf2389hf9sdsfkdjn9fh8w9eh923\",\n  \"data\": {\n    \"publicKey\": \"-----BEGIN PUBLIC KEY----- MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJMXKHxgvILqEaf/g6sZIEpylNdb2I0j wOgXOrXEesbrCdggin2o/X8YAd5+QVbCz9bwTOLexdIpp9tNkn+HlmUCAwEAAQ== -----END PUBLIC KEY-----\"\n  },\n  \"nodes\": [\n    {\n      \"type\": \"external_identity_connect_method:Qmsdkfjewiojfiwoefjdionfsoief\",\n      \"data\": {\n        \"method\": \"http\",\n        \"connection\": \"https://teacher.second.ngrok.io/ai\"\n      }\n    }\n  ]\n}\n\\`\\`\\`\n\nPotential additional routing:   \n__web__ - used by Second Browser for loading websites, replacing current domain names (adds \\`x-second-forward\\` header).  \n__email__ - points to an alternate email address to use for communication   \n__license-xyz__ - license for doing something  \n\nOptional encryption:   \n- routes can be encrypted with the username, or a pre-shared secret  \n\n\n\n### Shared Data   \n\nSyndicating or sharing data through Second is simple: when you \"ask\" another Second to store data for you, you also provide permissions for who else can access that data. You can easily see where your data is syndicated to, and revoke or add permissions on an ongoing basis. \n\nShared data has a specific structure with additional information. \\`node\\` schema: \n\n    {\n      \"type\": \"shared_node:Qmdsfjl\", \n      \"data\": {\n        \"_id\": \"idtestid:nick@test:542349823048923\", \n        \"type\": \"post:Qmsfljsdfff2398\", \n        \"name\": \"cb310245-3391-4d54-a7a0-69d4691c6c97\", \n        \"data\": {...},\n        \"v\": 1, \n        \"signer\": \"idtest:nick@test\",\n        \"sig\": \"kljf23oi230fj230f923=\"\n      }\n    }\n\n\\`type\\`: \"shared_node\" is the default sharing type that will include permissions and syndication  \n\\`data\\`: this is the data you actually want shared, or that was requested to be syndicated    \n\\`data._id\\`: this is the path to the source ID; describes who created the data and where is it located   \n\\`data.type\\`: type of data being shared   \n\\`data.name\\`: usually random    \n\\`data.data\\`: data of the data.type   \n\\`data.v\\`: version of this source data, 1-index   \n\\`data.signer\\`: author of the shared content, used for requesting the Public Key to verify the signature   \n\\`data.sig\\`: base64 signature by data.signer of JSON.stringify({_id, name, type, data, v, signer})  \n\n\nNodes that are expected to be attached:  \n- \\`permissions:Qmdsfjl\\` (who can access this shared data)  \n- \\`syndicatedTo:Qmsfj20j293\\` (where I shared the data to)  \n\n\n\n\n#### Examples of Common Shared Data Types/Schemas  \n\n\n__Posts__  \nCommonly used for microblogging or simple one-to-many messaging.   \nType: \\`post:Qmsf89j23fs\\`  \nExample Data: \n\\`\\`\\`json \n{\n  \"message\": \"test1\",\n  \"in_reply_to\": \"id_of_post\",\n  \"thread_ref\":\"uuid_of_thread\",\n  \"author\":\"same_as_signer\",\n  \"mentioned\": [\"identity_mentioned\"],\n  \"createdAt\":\"utcTimestamp\",\n}\n\\`\\`\\`\n\n\n\n__Relationships__ \nSometimes you want relationships to be validated and available publicly, and sometimes they can be one-sided (following) and with or without permission required. This model is intended to handle multiple relationship models.    \nType: \\`verified_relationship:Qmsklfdjfsf4\\`  \nExample Data: \n\\`\\`\\`json \n{\n  \n}\n\\`\\`\\`\n\n\n\n__Metadata Overlays__   \nAdd your own metadata to any type of addressable content (URLs, internal Ids, etc). Designed to be easily searchable through multiple lookup dimensions.   \nType: \\`metadata_overlay:Qmdsfj9jsffs\\`  \nExample Data: \n\\`\\`\\`json \n{\n  \"overlay_of\": {\n    \"type\" : \"metadata_url:Qmdsfljsdfldsjf\",\n    \"data\" : {\n      \"search_dimensions\": {\n        \"exact\": \"http://getasecond.com/\" ,\n        \"exactAlt\": [\"http://getasecond.com/\",\"http://www.getasecond.com/\"],\n        \"domain\": \"getasecond.com\",\n        \"domainAlt\": [\"getasecond.com\", \"www.getasecond.com\"],\n        \"matchOnMisc\": [\"xyz\"]\n      }\n    }\n  },\n  \"overlay_data\": {\n    \"type\" : \"string:Qmdsfjfljs\",\n    \"data\" : \"comment about overlay\"\n  },\n  \"createdAt\":\"utcTimestamp\"\n}\n\\`\\`\\`\n\n\n\n----\n\n#### Need More Information? \n\nWe have ambitious plans for Second and would love your input! We're writing documentation, improving scalability and security, and building sample apps. [Contact us](/about#contact)! \n\n&nbsp;\n&nbsp;\n`;\n      try {\n        \n        let marked = universe.require('marked');\n        htmlMenu = marked(menuMd);\n        htmlMain1 = marked(md1);\n        htmlMain2 = marked(md2);\n        \n        \n      }catch(err){\n        // marked doesn't exist yet \n        // - requires installation! \n        // - TODO: move to \"dependencies\" on code, install at runtime \n        \n        if(universe.checkPackage('marked').errorInstalling){\n          htmlMain = 'FAILED installing package!';\n        } else {\n          htmlMain = 'Please wait while packages are installed';\n          \n          (async function(){\n            \n            // let installed = await installPackage('left-pad');\n            let installed = await universe.installPackage('marked');\n            if(installed){\n              console.log('Installed!');\n            } else {\n              console.log('Failed installation');\n            }\n          })()\n          \n        }\n        \n        // installPackage('is-fqdn');\n        // installPackage('marked');\n        \n        \n        // console.error('failed1err:', err);\n        // htmlFromMd = 'failed1';\n      }\n      // console.log('markedInstalled:', markedInstalled);\n      \n      // let marked = universe.require('marked');\n      \n      // let htmlFromMd = marked('testing html from marked');\n      \n      \n      let page = `\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <meta charset=\"utf-8\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n            <title>Second</title>\n            \n            <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css\" />\n            \n            <style>\n              .container {\n                max-width: 960px;\n              }\n            </style>\n            \n          </head>\n          <body>\n                  \n            \n            <div class=\"container\">\n              <br />\n              <div class=\"links\">\n                <a href=\"/\">Home</a>\n                &nbsp;|&nbsp;\n                <a href=\"/about\">About</a>\n                &nbsp;|&nbsp;\n                <a href=\"/developers\">Developers</a>\n              </div>\n              <hr />\n            </div>\n            \n            <div class=\"container\">\n              <div class=\"content\">\n                ${htmlMain1}\n              </div>\n              <div class=\"columns\">\n                <div class=\"column is-3\">\n                  <div class=\"content\">\n                    ${htmlMenu}\n                  </div>\n                </div>\n                <div class=\"column is-9\">\n                  <div class=\"content\">\n                    ${htmlMain2}\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n          </body>\n        </html>\n      `;\n\n      await universe.httpResponse('send', page); //page.replace(new RegExp(\"\\\\n\", 'g'), \"\\\\n\"));\n      \n      return resolve(true);\n        \n        \n    }catch(err){\n      resolve({ERROR: true, err: err.toString()});\n    }\n    \n    \n  })\n})()"
  }
}